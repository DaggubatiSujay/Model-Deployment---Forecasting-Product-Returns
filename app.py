import pandas as pd
import numpy as np
import joblib
import streamlit as st
import warnings
warnings.filterwarnings('ignore') 


def data_clean(df):
    
    lower_bound = 1
    upper_bound = 38
    df['Quantity'] = df['Quantity'].clip(lower=lower_bound, upper=upper_bound)
    print("Capped the Quantity variable")
    
    
    
    lower_bound = 1
    upper_bound = 805.1700000000001

    # Cap the outliers
    df['TotalSales'] = df['TotalSales'].clip(lower=lower_bound, upper=upper_bound)
    print("Capped the Quantity variable")
    
    
    return df


def get_features(df):
    df['Category'] = df['ProductCode'].apply(lambda x: 'SpecialOrder' if x.startswith('zz') else ('General Inventory' if x.startswith('ai') else 'Others'))
    print("Created Category Column")
    
    categories = ["SpecialOrder", "General Inventory"]
    
    for category in categories:
        def is_category(Category):
            return 1 if Category == category else 0
        
        
        column_name = f"Category_{category}"
        df[column_name] = df["Category"].apply(is_category)
    
    
    
    major_subgroups_list = ['CUSTOM P/H', '2X4  #2', 'MERILLAT', 'LAP', '2X6  #2', 'MID CONTINET ', 'OSB', 'ANDERSEN', 'POPLAR   S4S', 'WINDSOR', '2X4   STUD/PRECUT', '2X12  #2', '5/4 Trim', 'SIMPSON HANGERS', '2X4   TREATED', 'SOFFIT', '2X8  #2', 'REBAR/REMESH', 'FLASHINGS', '2X6   TREATED', 'TRIM', 'ZIPWALL/FORCEFIELD', 'MDF - PRIMED --CASING', '2X6  CEDAR', 'MAPLE PLYWOOD', '2X10  #2', 'TYVEK/HOUSEWRAPS', 'MDF -  PRIMED BASE', 'PARTICLE BOARD ', '2X10   TREATED', 'MILGARD', '6X6  CEDAR POST', 'T&G PANELS', '2X4  CEDAR', 'MI - METAL IND.', '_NS & SPECIAL ORDER - CL', '_NS & SPECIAL ORDER ', 'GENERAL CONSTRUCTION -ADHESIVES', 'SIMPSON FASTENERS', 'POPLAR - SMALL', 'SILL SEALER', 'S4S CEDAR', 'MAPLE   S4S', '2X12   TREATED', 'CHAIN LINK', '4/4 Trim', '11-7/8"  LVL/MICRO', 'STAKES', 'PARTICLE BOARD SHELVING/TREADS', '1X4  #3', 'CLOSET HARDWARE', 'SPECIAL ORDER HARDIE', 'PRIMED  - JAMB', 'CEMENT MIXES', 'DRYWALL GALVANIZED SCREWS', 'KIT CHOICE SKU & KIT SKUS', '1X12  CEDAR', '2X6   STUD/PRECUT', 'YELLOW PINE PLYWOOD', '8"', '1X8  #3', 'Special Order Timbertech', 'BALUSTER -ABT', '1X12 "D" GRADE PINE', 'SPECIAL ORDER  SIDINGS', '2X8   TREATED', 'PRIMED SPRUCE', '2X8  CEDAR', 'BLIND STOP', 'POPLAR - CROWN', 'RND HEAD WIRE COLLATED NAIL 15 DEGREE FRAMING AND DECKING (HWCF SERIES)', '_NS & SPECIAL ORDER -CAB', 'PRIMED - SMALL', '1X4  CEDAR', '4X4   TREATED', 'PANEL', '30-35 DEGREE CLIPPED AND OFFEST ROUND HEAD PAPER TAPE COLLATED STRIP NAIL (PT SERIES)', 'TOPLOC', '18 GAUGE MEDIUM HEAD BRADS (PX & SENCO AX SERIES)', 'HANDRAIL BRACKETS', 'ALUM RAIL -ABT', 'SMOOTH BOX NAILS', 'LINDSEY', 'FORM/BRICK TIES', 'SASHCO', '1X6  CEDAR', 'LSL/TIMBERSTRAND', 'POPLAR --CASING', 'FASTENMASTER', '12"', '_NS & SPECIAL ORDER INTD', 'CARPENTERS - WOOD', 'CONCRETE NAILS', 'ROOF/GABLE VENTS', 'LIBERTY/BULL NOSE', 'OAK   S4S', '1X8  CEDAR', '9-1/2"  LVL/MICRO', 'SCREEN STOCK', 'RD Henry', 'SHIMS', 'GRK', 'HARDIE JOINTERS', 'PERMA COLUMNS', 'ANCHOR BOLTS', 'POCKET DOOR HARDWARE', 'AC FIR PLYWOOD', 'REBAR CHAIRS', '_NS & SPECIAL ORDER HW', 'Special Order Cedar', '_NS & SPECIAL ORDER MM', '15 GAUGE ANGLED FINISH NAIL (DA SERIES)', 'SHEETROCK/DRYWALL', 'CEDAR FENCE', 'POPLAR - BASE', 'TERRAIN BROWN', 'BEECH - HANDRAIL', 'HEAVY WIRE STAPLES 7/16" CROWN, 16 GAUGE, GALVANIZED (N SERIES)', 'SO Millwork', 'MAPLE - SMALL', 'GREAT STUFF', '1X12  #2 PINE', 'CABINETS', 'SPECIAL EXTERIOR SLAB', 'T&G', '4X4  CEDAR POST', '3/8" CROWN (.050"X.019") GALVANIZED HAMMER TACKER STAPLES (A11 SERIES)', 'MAPLE - CROWN', 'DECK TURNINGS,STEPS & RAILS', 'MAPLE - HANDRAIL', 'GALV FLAT', 'SILVER MAPLE', '6X6   TREATED', 'STEEL NUTS', 'CONCEALOC', 'OAK --CASING', 'Delivery Charge', 'BIRCH PLYWOOD', '2X12  CEDAR', 'WASHERS Z', 'FIRE RET. PRODUCTS', 'SCREEN ENCLOSURE', 'DRAIN TILE', 'MISC/SPECIAL ORDER/NS', 'PLANK SIDING', 'POLYSTYRENE/DOW STYROFOAM', '_NS & SPECIAL ORDER PNL', '2X6 CONST HEART REDWOOD', 'FIRE RET.', 'BIRCH - JAMB', 'DRYWALL GOLD AND S.STEEL', 'MEDIUM WIRE STAPLES 1/4" CROWN, 18 GAUGE, GALVANIZED (L SERIES)', '1X4  #2 PINE', 'COATED SINKER NAILS', 'SATIN BLACK  ', 'DUPLEX NAILS']
    
    # Function to check if subgroup is in major_subgroups_list
    def is_small_subgroup(subgroup):
        return 1 if subgroup not in major_subgroups_list else 0

    # Create subgroup_small column
    df['small_subgroup'] = df['Subgroup'].apply(is_small_subgroup)
    
    
    
    overall_return_rate = 0.09841222089993319
    
    subgroup_return_config = {'PRIMED - SMALL': 0.09538305428716387,'POPLAR - SMALL': 0.15921787709497207,'2X12  #2': 0.08820902188476999,'GENERAL CONSTRUCTION -ADHESIVES': 0.05115158007498661,'OSB': 0.12488209771741181,'2X6  #2': 0.10871566671781495,'RELIABOARD': 0.10667903525046382,'4/4 Trim': 0.17146776406035666,'FOIL FACED PLYWOOD': 0.11305732484076433,'SIMPSON HANGERS': 0.07883420926899187,'ROUGH FIR PANEL SIDING': 0.11535337124289195,'_NS & SPECIAL ORDER - CL': 0.046456692913385826,'1X4  #3': 0.11820182332599811,'T&G PANELS': 0.1475888943010229,'SOFFIT': 0.16203288490284007,'2X4  #2': 0.07969676735142779,'BEECH - HANDRAIL': 0.08569979716024341,'OIL RUBBED COPPER': 0.1408987052551409,'MAPLE - HANDRAIL': 0.11419939577039274,'HANDRAIL BRACKETS': 0.0634648370497427,'MDF - PRIMED --CASING': 0.21234371899186347,'RND HEAD WIRE COLLATED NAIL 15 DEGREE FRAMING AND DECKING (HWCF SERIES)': 0.0638188368502316,'CONCRETE NAILS': 0.061696658097686374,'FLASHINGS': 0.11042225201072386,'LAP': 0.20153630131328984,'DISCONTINUED HILLMAN': 0.09066183136899365,'HARDWARE - BIFOLDS': 0.08936550491510277,'PRIMED SPRUCE': 0.07456140350877193,'SAFEROOM DOORS/FRAMES': 0.08164739884393063,'COMMERCIAL DOOR HINGES': 0.08703220191470844,'LSL/TIMBERSTRAND': 0.08958517210944396,'2X10  #2': 0.0962800875273523,'ADVANTECH': 0.07186030893216924,'A GRADE/HI LINE': 0.08726752503576538,'GRK': 0.06422505307855626,'FLOOR PROTECTION': 0.09619047619047619,'2X4   TREATED': 0.11681395875821436,'KIT CHOICE SKU & KIT SKUS': 0.031231925968768073,'8"': 0.05474596297755022,'2X6  CEDAR': 0.09278538812785388,'CHAIN LINK': 0.21666158071406774,'OAK - CROWN': 0.10118043844856661,'_NS & SPECIAL ORDER ': 0.04480241631009313,'SILL SEALER': 0.04350471554609066,'1X12  #2 PINE': 0.14075382803297998,'_NS & SPECIAL ORDER -RS': 0.09060402684563758,'2X4  CEDAR': 0.1328637357299004,'11-7/8"  LVL/MICRO': 0.09006211180124224,'ANDERSEN': 0.01941283350865449,'SHEETROCK/DRYWALL': 0.08939149165320409,'5/4 Trim': 0.20971837488457987,'2X4   STUD/PRECUT': 0.139484311898105,'MI - METAL IND.': 0.03348530105329351,'PREFINISHED - SMALL': 0.09707822808671066,'MERILLAT': 0.015635668441895397,'PANELING ': 0.10930232558139535,'OAK   S4S': 0.12564705882352942,'STRUCTOGLASS': 0.09882583170254403,'PARTICLE BOARD ': 0.20225397464278527,'DRYWALL BLACK SCREWS': 0.08717105263157894,'CARPENTERS - WOOD': 0.05682903533906399,'PREFINISHED --CASING': 0.10924981791697014,'GREAT STUFF': 0.06978155339805825,'_NS & SPECIAL ORDER -CAB': 0.04201680672268908,'2X12   TREATED': 0.11459920755867113,'ZIPWALL/FORCEFIELD': 0.10289779628665625,'9-1/2"  LVL/MICRO': 0.0867195242814668,'MILGARD': 0.033523414549853116,'6X6  CEDAR POST': 0.12984165651644336,'BALUSTER -ABT': 0.1262135922330097,'S4S CEDAR': 0.18179295031917847,'BARN DOOR HARDWARE': 0.09596344249809596,'1X12  CEDAR': 0.127419922562478,'1X4  CEDAR': 0.1173931808372896,'CEDAR FENCE': 0.14625506072874495,'GLULAMS': 0.09282422646477946,'CONCEALOC': 0.10573823339780787,'TOPLOC': 0.0861812778603269,'TERRAIN BROWN': 0.14388489208633093,'ACCESSORIES -SR': 0.08585858585858586,'FASTENMASTER': 0.0696078431372549,'2X10   TREATED': 0.13756033347959631,'1X6  CEDAR': 0.11969480209823558,'CEMENT MIXES': 0.12682926829268293,'1X12 "D" GRADE PINE': 0.14797728885734562,'TRIM': 0.17384338073302624,'SCREEN ENCLOSURE': 0.09108040201005026,'1X12  #3': 0.10491257285595337,'MAHOGANY SLAB': 0.08949771689497717,'MDF -  PRIMED BASE': 0.24720357941834453,'POCKET DOOR HARDWARE': 0.07269874476987448,'MISC. PANELS': 0.09379968203497616,'TYVEK/HOUSEWRAPS': 0.05236634531113059,'REBAR/REMESH': 0.04327837666455295,'POPLAR --CASING': 0.1743362831858407,'PLYFORM': 0.09156050955414012,'MAPLE PLYWOOD': 0.16002415458937197,'MDF - PRIMED CROWN': 0.1147036181678214,'STEEL NUTS': 0.06267806267806268,'2X8  #2': 0.1146060870831513,'2X6   TREATED': 0.1264855687606112,'1X8  CEDAR': 0.12058212058212059,'WASHERS Z': 0.06916243654822335,'OAK PLYWOOD': 0.09925725860904794,'FORM/BRICK TIES': 0.057692307692307696,'UTILITY GRADE': 0.0924956369982548,'SMOOTH BOX NAILS': 0.0618822518263859,'YELLOW PINE PLYWOOD': 0.06826923076923076,'1X8  #3': 0.08389513108614233,'2X8   TREATED': 0.10217480508822323,'MID CONTINET': 0.021194478969058676,'MAPLE - SMALL': 0.1231925968768074,'_NS & SPECIAL ORDER HW': 0.06179775280898876,'REBAR CHAIRS': 0.06504961411245866,'BULK 3-1/2"': 0.09631490787269682,'MAPLE - DR STOP': 0.09917355371900827,'CLOSET HARDWARE': 0.06873219373219373,'MAPLE - BASE': 0.10921501706484642,'MAPLE --CASING': 0.11356932153392331,'MAPLE   S4S': 0.14674838270343887,'BLIND STOP': 0.22061191626409019,'_NS & SPECIAL ORDER INTD': 0.05450941526263627,'PANEL': 0.16251113089937666,'SPECIAL ORDER HARDIE': 0.15125804564072556,'POPLAR   S4S': 0.20945310049147756,'GALVANIZED ROOFING NAILS': 0.0779816513761468,'ROOF EDGE': 0.09236111111111112,'4X4  CEDAR POST': 0.10806270996640538,'HARDIE JOINTERS': 0.06813063063063063,'SASHCO': 0.05805805805805806,'1X2  CEDAR': 0.1040268456375839,'OAK - LIBRARY MLD': 0.10105871029836382,'BIRCH PLYWOOD': 0.10273972602739725,'ALEX PLUS': 0.08541846419327007,'OAK - DR STOP': 0.09568480300187618,'FIRE RET. PRODUCTS': 0.0869047619047619,'HILLMAN PRODUCTS': 0.09872922776148582,'POPLAR   - RANDOM': 0.09115281501340483,'OAK  SLAB': 0.08816705336426914,'MDO': 0.0949667616334283,'DRYWALL GOLD AND S.STEEL': 0.07702182284980745,'3/8" CROWN (.050"X.019") GALVANIZED HAMMER TACKER STAPLES STCR5019 SERIES': 0.09821428571428571,'4X4   TREATED': 0.11073541842772612,'KRAFT FACED': 0.09279778393351801,'POWER LOADS': 0.07680722891566265,'POWER NAILS': 0.07469180565627266,'ALDER   S4S': 0.11212333566923616,'MISCELLANEOUS': 0.10025488530161428,'ALDER PLYWOOD': 0.0944741532976827,'WINDOW WELLS': 0.08876811594202899,'HILLMAN NUMBERS': 0.08521739130434783,'MAIL BOXES': 0.09040590405904059,'PICERNE MINI BLINDS  NON STOCK': 0.08828828828828829,'FLAG POLE HARDWARE': 0.09523809523809523,'PRIVACY -J': 0.09464627151051626,'SMOKE ALARMS & DETECTORS': 0.09533073929961089,'GRANDVIEW ': 0.06684856753069578,'SPRING  - STOP': 0.08193979933110368,'FOAM TAPE WEATHERSTRIP': 0.09533073929961089,'MOEN BATH ACCESSORIES': 0.0880503144654088,'SHOWER RODS': 0.09386973180076628,'DEADBOLT -S': 0.09450337512054002,'DUMMY -J': 0.09468599033816426,'3/8" CROWN (.050"X.019") GALVANIZED HAMMER TACKER STAPLES (A11 SERIES)': 0.06901128069011281,'30-35 DEGREE CLIPPED AND OFFEST ROUND HEAD PAPER TAPE COLLATED STRIP NAIL (PT SERIES)': 0.06534954407294832,'ROOF/GABLE VENTS': 0.06562342251388188,'OAK - SMALL': 0.0917180013689254,'WIRE SHELVING': 0.09191176470588236,'OAK --CASING': 0.09330143540669857,'PICTURE & MIRROR HARDWARE': 0.09486931268151017,'ENTRY -S': 0.09486931268151017,'PASSAGE -J': 0.09455587392550144,'COATED SINKER NAILS': 0.07114882506527415,'TERPOLYMER': 0.07342657342657342,'BY-PASS HARDWARE': 0.08710801393728224,'BULK 4"': 0.08862745098039215,'ACCESS PANEL-TOLIET REPAIR PARTS': 0.09712586719524281,'CORVIAS ': 0.09523809523809523,'PRIMED - BASE': 0.10054347826086957,'6-P TXT  SLAB': 0.09515096065873742,'PRIMED  - JAMB': 0.14063108687183482,'6-P TXT BIFOLD': 0.0947075208913649,'WINDSOR': 0.026559520566603104,'CABINET KNOBS': 0.09636184857423795,'STAINABLE': 0.07391613361762615,'POPLAR - CROWN': 0.21003642250101173,'POLYSTYRENE/DOW STYROFOAM': 0.09967637540453074,'MAPLE - CROWN': 0.148,'LINCOLN  SLAB': 0.09346642468239565,'FRAMING 7-1/4': 0.08833619210977701,'CELLULAR BRICKMOULD': 0.0959349593495935,'VENTS ': 0.08845208845208845,'FIBER CEMENT 7-1/4': 0.08176614881439084,'LATEX  ': 0.09141274238227147,'1X6  #3': 0.09484066767830046,'MIRROR': 0.09674234945705824,'SHIMS': 0.07608695652173914,'DRYWALL GALVANIZED SCREWS': 0.05358385525400139,'YARROW / CRAFTSMAN BIFOLD': 0.09036144578313253,'GALV STEEL NUTS': 0.07801950487621906,'BIRCH - JAMB': 0.13893653516295026,'LINDSEY P/H': 0.060350030175015085,'BIRCH SLAB': 0.09643788010425716,'MAPLE   - RANDOM': 0.09114811568799298,'GALV FLAT': 0.0671806167400881,'FLOORING PDL 35': 0.1072961373390558,'Special Order Treated': 0.08070432868672046,'SPECIAL ORDER  SIDINGS': 0.16815856777493607,'Special Order Cedar': 0.06645569620253164,'MEDIUM WIRE STAPLES 1/4" CROWN, 18 GAUGE, GALVANIZED (L SERIES)': 0.076980014803849,'DECK TURNINGS,STEPS & RAILS': 0.0835030549898167,'12"': 0.07868681605002606,'OAK - HANDRAIL': 0.09837467921300257,'MISC/SPECIAL ORDER/NS': 0.08262548262548262,'HARDIE/FIBER CEMENT': 0.09423076923076923,'SPECIAL EXTERIOR SLAB': 0.06655665566556655,'AC FIR PLYWOOD': 0.10341555977229601,'SCREEN STOCK': 0.1830065359477124,'HEAVY WIRE STAPLES 7/16" CROWN, 16 GAUGE, GALVANIZED (N SERIES)': 0.07019867549668875,'RD Henry': 0.05431971029487843,'ATTIC LADDERS': 0.09482758620689655,'MELAMINE': 0.1018935978358882,'MAHOGANY PLYWOOD': 0.09668989547038327,'RND HEAD PLASTIC COLLATED STRIP NAILS (DPS SERIES)': 0.09307875894988067,'_NS & SPECIAL ORDER MM': 0.061511423550087874,'CHEYENNE  SLAB': 0.09502664298401421,'CHEYENNE BIFOLD': 0.08616404308202154,'LINCOLN BIFOLD': 0.09050179211469533,'STAKES': 0.04874699622382424,'MAPLE - JAMB': 0.1079447322970639,'AZEK': 0.10144927536231885,'BEECH --CHAIR RAIL': 0.1016781836130306,'T&G': 0.15654761904761905,'Special Order Timbertech': 0.07588187038556193,'LABOR - VW': 0.09560975609756098,'_NS & SPECIAL ORDER PNL': 0.08338442673206621,'DENSEGLASS/GYP SHEATHING': 0.125193199381762,'Special Order Azek': 0.08907823392718822,'FLUSH - BIRCH  BIFOLD': 0.09271523178807947,'YARROW / CRAFTSMAN SLAB': 0.09696458684654301,'6X6   TREATED': 0.10344827586206896,'POPLAR --CHAIR RAIL': 0.10897435897435898,'ROMAN BIFOLD': 0.08995633187772925,'THRESHOLD/SILLS  ': 0.09540329575021683,'PRIMED WHT PINE FRAME': 0.09597806215722121,'BLOW IN INSULATION': 0.09895337773549001,'POPLAR - BASE': 0.16602528862012095,'BEECH   S4S': 0.11908646003262642,'TIGERWOOD': 0.11181601903251388,'HANDRAIL KITS': 0.09071117561683599,'TTECH RAIL': 0.0926076360682372,'SILT FENCE': 0.09217877094972067,'FURRING STRIPS': 0.10526315789473684,'FIRE RET.': 0.10138805069402534,'4X6  CEDAR POST': 0.09539748953974896,'BEECH -CASING': 0.10388349514563107,'SATIN BLACK  ': 0.1717534410532615,'BALTIC BIRCH PLYWOOD': 0.09358752166377816,'CONSTRUCTION  SLAB': 0.26437699680511184,'15 GAUGE ANGLED FINISH NAIL (DA SERIES)': 0.06600467289719626,'18 GAUGE MEDIUM HEAD BRADS (PX & SENCO AX SERIES)': 0.055977229601518026,'PARTICLE BOARD SHELVING/TREADS': 0.18729582577132486,'CABINET HINGES & CATCHES': 0.08536585365853659,'FLUSH STEEL  SLAB': 0.10067114093959731,'2X6   STUD/PRECUT': 0.12044072948328267,'GALVANIZED BOX NAILS': 0.08769106999195495,'RECIPROCATING SAW BLADES': 0.09057301293900184,'1X6  #2 PINE': 0.1064,'MAPLE  - NEWEL': 0.1,'SIDING/EXT TRIM': 0.10121836925960637,'1X8  #2 PINE': 0.11626139817629179,'ROOFING FELT': 0.09362389023405973,'SUBFLOOR -ADHESIVES': 0.07547169811320754,'FIREPLACE': 0.09731876861966236,'2X6 CONST HEART REDWOOD': 0.1357615894039735,'2X12  CEDAR': 0.11581422692533803,'2X8  CEDAR': 0.10679611650485436,'BI-FOLD HARDWARE': 0.09801980198019802,'2-P SQ  SLAB': 0.08933002481389578,'SPADE / PADDLE BITS': 0.09655172413793103,'DUCT TAPE': 0.09598432908912831,'SHAKE/SHINGLE': 0.16124661246612465,'_NS & SPECIAL ORDER.': 0.08643933386201427,'SCREEN MOULD': 0.09705042816365367,'DRILLS CORDLESS': 0.09722222222222222,'ANCHOR BOLTS': 0.06328451882845189,'DUOFAST NAILS': 0.09643201542912247,'SILICONE ': 0.07473841554559044,'1X4  #2 PINE': 0.11890034364261168,'DECK RAIL': 0.09639727361246349,'SPRAY PRIMER': 0.09780439121756487,'PRIMED - -CASING': 0.09876543209876543,'VALLEY TIN': 0.08333333333333333,'HANDRAIL -CEDAR': 0.09403254972875226,'BALUSTER -TREATED': 0.10599478714161599,'FRP PANEL -ADHESIVES': 0.0981169474727453,'ALUM RAIL -ABT': 0.10676392572944297,'HARDBOARD ': 0.08376193975018369,'ENTRY -KWIKSET': 0.08757819481680071,'PREFINISHED - JAMB': 0.09958847736625515,'DUPLEX NAILS': 0.0752990851513019,'CORVIAS / PICERNE  P/H': 0.09184629803186505,'SILVER MAPLE': 0.13881748071979436,'MARKING ': 0.09380863039399624,'PERMA COLUMNS': 0.08844275637547477,'SKIRT BOARD': 0.09375,'POPLAR - HANDRAIL': 0.09271523178807947,'CONCRETE BLOCKS': 0.09500959692898273,'COLUMN ': 0.09686888454011741,'MEDICINE CABINET PICERNE': 0.09560975609756098,'HEX BOLT GALV': 0.09405940594059406,'TREATED PLYWOOD': 0.1005586592178771,'MAHOGANY --CASING': 0.09380692167577413,'BALUSTER - CEDAR': 0.1261335531739489,'JOIST HANGER PAPER TAPE COLLATED NAIL (PTJH SERIES)': 0.09326424870466321,'PINE   - ROSETTE/CORNER': 0.09881422924901186,'1X4   TREATED': 0.09581395348837209,'PREFINISHED - BASE': 0.10166919575113809,'SHINGLE': 0.15356622998544395,'MAPLE   - PANEL MLD': 0.11168831168831168,'HARDWARE CLOTH': 0.0979020979020979,'PLANK SIDING': 0.1532033426183844,'OAK - BASE': 0.10666666666666667,'MARINE PLYWOOD': 0.09514747859181731,'SAFETY GLASSES & GOGGLES': 0.09099350046425256,'SCREEN FABRIC': 0.09861751152073733,'PRIMED WHITE PINE BM': 0.09507346585998272,'LOGAN BIFOLD': 0.09114811568799298,'POPLAR   - PANEL MLD': 0.13576415826221877,'_NS & SPECIAL ORDER -WW': 0.09505703422053231,'HEAVY WIRE STAPLES 1/2" CROWN, 16 GAUGE, GALVANIZED (GS SERIES)': 0.09760956175298804,'HEAVY WIRE STAPLES 1/2" CROWN, 16 GAUGE, GALVANIZED (BCS SERIES)': 0.09628217349857007,'BALUSTER - BRONZE': 0.1095636025998143,'2X4 CONST HEART REDWOOD': 0.1343042071197411,'DRIVER BITS': 0.09674234945705824,'WHITE PINE - BASE': 0.0969807868252516,'HOOKS MISC.': 0.09780439121756487,'MAHOGANY   S4S': 0.0960989533777355,'REBAR TIE WIRE': 0.095703125,'POLYETHELENE ': 0.07561156412157154,'PRIMED - CROWN': 0.10351377018043685,'_NS & SPECIAL ORDER - CED': 0.09864188706218728,'15 GAUGE ANGLED FINISH NAIL (BA SERIES)': 0.10166177908113393,'ALDER - SMALL': 0.10230414746543778,'CARRIAGE GALV': 0.09369676320272573,'16 GAUGE MEDIUM HEAD FINISH NAIL (PB SERIES)': 0.0953757225433526,'FIR FG SLAB': 0.0922242314647378,'MAPLE - LIBRARY MLD': 0.11058150619637751,'ALDER --CASING': 0.10335448776065277,'ANTIQUE PALM': 0.1304034582132565,'CROWBAR PRYBAR RIPBAR': 0.09542356377799416,'STAPLES': 0.09786821705426356,'SPLIT RAIL FENCING': 0.10009813542688911,'QUARTER ROUND': 0.09659613615455381,'BASE SHOE': 0.09671532846715329,'_NS & SPECIAL ORDER  T': 0.09217877094972067,'5" HOOK & LOOP': 0.07834101382488479,'2X10  CEDAR': 0.1095679012345679,'MAPLE --CHAIR RAIL': 0.11281588447653429,'SILVERLINE': 0.09557522123893805,'2-P SQR BIFOLD': 0.08158508158508158,'SCREWS      ': 0.0946073793755913,'WINDBRACING': 0.09551098376313276,'4X6   TREATED': 0.1062553556126821,'SOLVENT ': 0.09107303877366997,'DRAIN TILE': 0.07723577235772358,'MISC PAINT TOOLS': 0.0979020979020979,'WHITE PINE -DR STOP': 0.10078277886497064,'INTERNAL GRILLE INSERT': 0.09712586719524281,'CPVC PIPE': 0.0979020979020979,'CPVC PIPE FITTINGS 1/2"': 0.09780439121756487,'LINDSEY': 0.036544850498338874,'CUSTOM P/H': 0.02503015681544029,'6-PANEL    P/H': 0.09476309226932668,'28 DEGREE CLIPPED HEAD WIRE COLLATED STRIP NAIL (BW SERIES)': 0.0962566844919786,'OAK - JAMB': 0.10033167495854063,'DISCONTINUED NAILS': 0.09780439121756487,'SPRAY': 0.09184629803186505,'2X2  CEDAR': 0.09770687936191426,'MISCELLANEOUS NAILS': 0.09366130558183539,'OAK --CHAIR RAIL': 0.1008729388942774,'_NS & SPECIAL ORDER SIDING': 0.12978889757623144,'SILICONE': 0.0979020979020979,'WALNUT   - RANDOM': 0.09269162210338681,'CHERRY   - RANDOM': 0.09297912713472485,'HICKORY   - RANDOM': 0.09437559580552908,'_NS & SPECIAL ORDER VW': 0.09815354713313897,'LATTICE': 0.10150375939849623,'ALDER - BASE': 0.09962406015037593,'SPECIAL ORDER INT DOORS': 0.08935018050541517,'DRAWER SLIDES': 0.0983754512635379,'MAHOGANY - SMALL': 0.09643201542912247,'MAHOGANY - JAMB': 0.0969637610186092,'WINTHROP / CONMORE BIFOLD': 0.08691983122362869,'ALDER --CHAIR RAIL': 0.09712586719524281,'WHITE PINE - SMALL': 0.10048309178743961,'WEATHERSTRIP  ': 0.08597986057319908,'ROMAN  SLAB': 0.09404096834264432,'DYNAFLEX 230': 0.09252336448598131,'1X8 "D" GRADE PINE': 0.09877704609595485,'1X6 "D" GRADE PINE': 0.09482001755926252,'SCREW PLUG HOLES': 0.0963035019455253,'WHITE PINE - HANDRAIL': 0.09771689497716896,'POPLAR - LIBRARY MLD': 0.11802973977695168,'DEADBOLT SINGLE CYLINDER -KWIIKSET': 0.07377647918188458,'PRIVACY -KWIKSET': 0.08558951965065502,'PASSAGE -KWIKSET': 0.06915629322268327,'DUMMY - KWIKSET': 0.08571428571428572,'GALVANIZED CASING NAILS': 0.0966796875,'OAK   - RANDOM': 0.0876736111111111,'PARTING STOP': 0.09731876861966236,'FIRE FOAM': 0.09712586719524281,'DOOR VIEWERS': 0.08737864077669903,'STONE PRODUCTS': 0.09052808046940486,'CORRUGATED ROOFING': 0.09951690821256039,'LIBERTY/COLONIAL': 0.08711111111111111,'SCAFFOLD PLANK': 0.09506057781919851,'CIRCULAR SAWS': 0.0979020979020979,'WIRE COLLATED COIL ROOFING NAIL (CR SERIES)': 0.09446564885496184,'BLIND  INSERT': 0.0979087452471483,'CEDAR   - RANDOM': 0.09751243781094528,'LAG SCREW GALV': 0.09482001755926252,'5/4 DECKING  ': 0.1077127659574468,'SCREWDRIVER BITS - OTHER': 0.09304511278195489,'FENCE POST': 0.10211946050096339,'GATE HARDWARE': 0.09595484477892756,'DECK SCREWS COATED': 0.09834469328140215,'6-PANEL STEEL SLAB': 0.09800190294957184,'ALDER  - PANEL MLD': 0.1039461020211742,'FORM TUBES': 0.10431654676258993,'ANTIGUA GOLD': 0.11072961373390558,'GARMENT & COAT HOOKS': 0.09770687936191426,'BEECH - BASE': 0.10059171597633136,'OAK FG SLAB': 0.09760956175298804,'VALUE PLACE INT. DOORS': 0.09404990403071017,'FLUSH - MAHOGANY  BIFOLD': 0.09852216748768473,'MASONARY BIT': 0.09324452901998097,'DIRECT SET  ': 0.09602327837051407,'RED THINGS': 0.09751243781094528,'EXTERNAL GRILLE INSERT': 0.09602327837051407,'WHITE PINE --CASING': 0.0968609865470852,'FLUSH - OAK  BIFOLD': 0.09418282548476455,'MAHOGANY P/H': 0.09533073929961089,'CONCRETE TOOLS': 0.09683794466403162,'SIDE WINDER': 0.09780439121756487,'Window/Door Parts': 0.06666666666666667,'WHITE PINE --CLOSET POLE': 0.09813542688910697,'STORM DOORS': 0.0950533462657614,'HINGE PIN  - STOP': 0.09655172413793103,'MISC. LENGTH ROPE AND CORD': 0.09674234945705824,'8-1/4" BLADES': 0.09780439121756487,'HEX BOLT Z': 0.09655172413793103,'ENTRY -J': 0.09770687936191426,'INSERT ': 0.09941520467836257,'LIBERTY/BULL NOSE': 0.04565837749694252,'1X6   TREATED': 0.09665071770334928,'SILL LUG': 0.098922624877571,'DOOR BOTTOM': 0.08593091828138164,'OAK   - ROSETTE/CORNER': 0.097678916827853,'DOOR SKIN': 0.09802073515551367,'BLUM': 0.08148148148148149,'EPOXY PUTTY': 0.09780439121756487,'ALDER - LIBRARY MLD': 0.09940944881889764,'SILL STOCK': 0.09693372898120672,'FRAMESAVER': 0.09760956175298804,'MAHOGANY - BASE': 0.0945945945945946,'GORILLA TAPE': 0.09579667644183773,'STOPS RUST ENAMEL': 0.09655172413793103,'PKG 4"': 0.09870388833499502,'BEECH - CROWN': 0.10048780487804879,'EXOTIC MISC.   - RANDOM': 0.09468599033816426,'BALL CATCHES AND PLATES': 0.09428571428571429,'BOX 3-1/2"': 0.0967741935483871,'FLUSH      P/H': 0.09662288930581614,'BEECH PLYWOOD': 0.10028382213812677,'CULL LUMBER': 0.09167446211412535,'BEADED CEILING': 0.09911678115799803,"MEASURING 25' +": 0.09617271835132483,'APRONS': 0.09760956175298804,'SPACKLING': 0.09770687936191426,'LOGAN  SLAB': 0.096,'HAMMERS': 0.09712586719524281,'6-1/2" BLADES': 0.09565217391304348,'ALUM RAIL -POST CAP ABT': 0.09645131938125569,'LINDSEY SLAB': 0.08820882088208822,'LAG SCREW Z': 0.0968054211035818,'BATH ACCESSORIES': 0.07777777777777778,'PVC DWV FITTINGS 4"': 0.09760956175298804,'PSC Labor': 0.09369024856596558,'2X8 CONST HEART REDWOOD': 0.10246679316888045,'MAILBOX POSTS': 0.09433962264150944,'PRIMED - DR STOP': 0.09619047619047619,'LATH': 0.09595484477892756,'LUBRICANTS - PNEUMATIC TOOLS': 0.09751243781094528,'SIMPSON FASTENERS': 0.04698972099853157,'FLAGGING': 0.09658536585365854,'2X12 CONST HEART REDWOOD': 0.0966796875,'POCKET DOOR LOCK': 0.09065934065934066,'SELF DRILL': 0.09664694280078895,'_NS & SPECIAL ORDER - CS': 0.09856459330143541,'FINE DRYWALL SCREWS': 0.09683794466403162,'BC YELLOW PINE PLYWOOD': 0.09505703422053231,'18 GAUGE SLIGHT HEAD BRADS (PY / AY SERIES)': 0.09455587392550144,'4X4 CONST HEART REDWOOD': 0.09772296015180265,'MISC STEEL SLAB': 0.10119047619047619,'RND HEAD PLASTIC SHEET COLLATED NAIL 15 DEGREE (MPC SERIES)': 0.09868995633187773,'SHELF BRACKETS': 0.0963035019455253,'POWDER COAT ': 0.09770687936191426,'OAK  - NEWEL': 0.09683794466403162,'ALDER - JAMB': 0.10127826941986234,'WOOD   INSERT': 0.09824902723735408,'FLUSH BOLT ': 0.09803921568627451,'SKYLIGHTS': 0.09432146294513956,'5" PEEL & STICK': 0.09655172413793103,'4"X24"  SANDING BELTS': 0.09579667644183773,'1X4 "D" GRADE PINE': 0.09615384615384616,'SQUARE': 0.09731876861966236,'CARRIAGE Z': 0.0975609756097561,'ALL PURPOSE': 0.09560975609756098,'CHAMFER STRIP': 0.09652509652509653,'1-LITE  INSERT': 0.09643201542912247,'HEX SHEET METAL SCREWS': 0.09770687936191426,'IMPERIAL  SLAB': 0.09519321394910461,'RACHETS': 0.09655172413793103,'FAUCET LINES': 0.09780439121756487,'SUPPLY VALVES': 0.09780439121756487,'_NS & SPECIAL ORDER P&E': 0.09176029962546817,'PLUMBING GLUES AND PRIMERS': 0.09693372898120672,'PVC SCHEDULE 40': 0.09607843137254903,'SANITARY TEE - 1-1/2': 0.0979020979020979,'12" BLADES': 0.09712586719524281,'LABOR PDL 46': 0.11090742438130156,'1X6 B HEART REDWOOD': 0.09850746268656717,'INTERCHANGE': 0.09881422924901186,'ALDER - CROWN': 0.09953051643192488,'O/S CORNER': 0.09644194756554307,'WESTERN ': 0.09500959692898273,'FRAMING NAILER': 0.09770687936191426,'STILE & RAIL SLABS': 0.09853658536585366,'TEE HINGES': 0.09734513274336283,'CHALK LINES': 0.0969637610186092,'MINERAL': 0.09753694581280788,'MAHOGANY - DR STOP': 0.09664694280078895,'OAK  P/H': 0.09372071227741331,'BIRCH   - RANDOM': 0.0970873786407767,'BEECH - LIBRARY MLD': 0.09831181727904667,'TREAD - OAK': 0.0958904109589041,'COVE': 0.09506398537477148,'PREFINISHED BIFOLD': 0.09519230769230769,'BEECH - SMALL': 0.10162991371045062,'_NS & SPECIAL ORDER FHP': 0.09341637010676157,'WHITE GLUE': 0.09813542688910697,'MULLION ': 0.0992063492063492,'ALDER   - RANDOM': 0.0953757225433526,'WINTHROP / CONMORE SLAB': 0.09306260575296109,'3"X21"  SANDING BELTS': 0.09770687936191426,'14"  GLULAMS': 0.09731876861966236,'SHELLAC': 0.0979020979020979,'ALCHOL': 0.09780439121756487,'PVC FITTINGS 2"': 0.09741550695825049,'FENDER WASHERS': 0.09712586719524281,'ICE MELT & SCRAPERS': 0.09741550695825049,'DOWELL PINS & RODS': 0.09753694581280788,'MYLAR': 0.09780439121756487,'STRIKES AND LATCHES': 0.09731876861966236,'PVC SCHEDULE 200': 0.09702970297029703,'CONCRETE': 0.09731876861966236,'BALUSTER -REDWOOD': 0.09881422924901186,'WHITE PINE - CROWN': 0.099609375,'PREFINISH ACCESSORIES': 0.09423076923076923,'MAPLE     - ROSETTE/CORNER': 0.09722222222222222,'FOAM BOARD -ADHESIVES': 0.09860557768924302,'6X6 CONST HEART REDWOOD': 0.10451977401129943,'Special Order Redwood': 0.09607843137254903,'MULLION': 0.09860557768924302,'1X8   TREATED': 0.10176125244618395,'CAULKING GUNS': 0.09741550695825049,'SAND': 0.09737098344693282,'SUNSET': 0.09645669291338582,'EXTERIOR - CORVIAS/PICERNE': 0.09342230695900858,'BEECH   - RANDOM': 0.09533073929961089,'LINSEED OIL': 0.09780439121756487,'CONCRETE PATCHES': 0.09840954274353876,'ASH   - RANDOM': 0.09741550695825049,'PVC DWV FITTINGS 2"': 0.09770687936191426,'PINE   - RANDOM': 0.09722222222222222,'BASSWOOD   - RANDOM': 0.09760956175298804,'OAK   - PANEL MLD': 0.10308285163776493,'BEECH  - PANEL MLD': 0.09931170108161258,'CONTINOUS HINGES': 0.09718172983479106,'FINISH NAILER': 0.09780439121756487,'MEDIUM WIRE STAPLES 7/32" CROWN, 18 GAUGE, GALVANIZED (SX SERIES)': 0.09722222222222222,'LANDSCAPING': 0.10271317829457365,'CORRUGATED STEEL': 0.09864603481624758,'CARIBBEAN REDWOOD': 0.10067763794772508,'PENCIL PENS MARKERS CRAYONS': 0.09751243781094528,'MAPLE ASTRAGAL': 0.09741550695825049,'DRYER VENTS & HOSE': 0.09674234945705824,'TRASH BAGS': 0.09731876861966236,'I JOISTS': 0.09751243781094528,'DECORATIVE  INSERT': 0.0981169474727453,'ROOF': 0.09840954274353876,'TOP SOIL': 0.09760956175298804,'MISC. ITEMS': 0.09683794466403162,'PLEXIGLASS': 0.09770687936191426,'CORNER': 0.09731876861966236,'TOILET BOLT-TOLIET REPAIR PARTS': 0.09760956175298804,'ROOFING CAPS AND STAPLES': 0.09607843137254903,'ALDER - HANDRAIL': 0.098922624877571,'TRUSS COMBO SCREWS': 0.0900735294117647,'POWER TOOLS MISCELLANEOUS': 0.09780439121756487,'SHOP VAC': 0.0979020979020979,'SAWS -PT': 0.09731876861966236,'MULTIPOINT': 0.0923217550274223,'STRINGERS': 0.09902912621359224,'4"   CEDAR SIDING': 0.09683794466403162,'MISC POWER TOOL ACCESSORIES': 0.09683794466403162,'SPECIAL ORDER TRUSSES': 0.09786821705426356,'BISCUITS': 0.09731876861966236,'POLYURETHANE -ADHESIVES': 0.0979020979020979,'T&G PINE': 0.09734513274336283,'LINDSEY ': 0.09674234945705824,'SPRAY ADHESIVES': 0.09731876861966236,'FLOOR  - STOP': 0.09770687936191426,'SHINGLES': 0.09772951628825272,'SANDY BIRCH': 0.10054844606946983,'9" -PAINT ROLLER': 0.09760956175298804,'9" -PAINT ROLLER FRAME': 0.09780439121756487,'BRUSHES PAINT': 0.09870388833499502,'GOLD EXTERIOR ': 0.09780439121756487,'QT': 0.0979020979020979,'GALVANIZED RING SHANK NAILS': 0.09722222222222222,'CHIP': 0.09770687936191426,'ALCOHOL': 0.0979020979020979,'PAINTERS TAPE': 0.09674234945705824,'ASTRAGAL -EXTERIOR DOORS': 0.09792284866468842,'CHERRY - SMALL': 0.09770687936191426,'MSR LUMBER': 0.09386973180076628,'HARDWARE': 0.10248756218905472,'BLUE 2 COAT': 0.0979020979020979,'METAL STUDS': 0.09664694280078895,'RAGS': 0.09702970297029703,'NAILS & STAPLES': 0.09831181727904667,'MAHOGANY   - RANDOM': 0.09763313609467456,'ROOF COATINGS': 0.09980430528375733,'WHITE PINE ASTRAGAL': 0.0981169474727453,'LOCK WASHER': 0.09741550695825049,'STOP NUTS': 0.0979020979020979,'GOLD INTERIOR': 0.09780439121756487,'CHALK LINE CHALK': 0.09617271835132483,'ACETONE': 0.09780439121756487,'TR WASH LATH': 0.0979020979020979,'STRAIGHT BLADES': 0.09722222222222222,'14"  LVL/MICRO': 0.09683794466403162,'SPECIAL ORDER LUMBER PROJECTS': 0.09864253393665158,'VANITY, TOPS, MIRRORS': 0.09784735812133072,'MOEN LAVATORY FAUCETS': 0.0979020979020979,'1X4 B HEART REDWOOD': 0.09900990099009901,'PLASTIC WOOD': 0.09731876861966236,'LUMBER PROJECTS': 0.09702970297029703,'DOOR THREASHOLDS/SILLS': 0.0989010989010989,'BASEBOARD -REGISTERS & GRILLES': 0.09780439121756487,'Delivery Charge': 0.06118143459915612,'PEGBOARD ': 0.09598432908912831,'ALUM RAIL -CBT': 0.09516129032258064,'AZEK DECKING': 0.09860557768924302,'CLC GLOVES': 0.09702970297029703,'NEO S.PIERCE SCREWS': 0.09840954274353876,"MEASURING SHORT TAPE 3' - 24'": 0.09780439121756487,'COMBINATION KITS - CORDLESS': 0.0979020979020979,'DRY ENAMEL': 0.09780439121756487,'GYPSUM WALLBOARD NAILS': 0.09760956175298804,'SIDEWALL SHAKE': 0.09850746268656717,'GARAGE HEADER': 0.09780439121756487,'HWH NEO TEK SCREWS': 0.0979020979020979,'SCRUB BRUSH': 0.09770687936191426,'POPLAR - DR STOP': 0.09931170108161258,'RADIOS': 0.0979020979020979,'PLASTIC': 0.09722222222222222,'UTILITY KNIVES': 0.09722222222222222,'GALV SPLIT LOCK': 0.09760956175298804,'QUIKDRIVE SCREWS': 0.09821428571428571,'U-BOLT': 0.0979020979020979,'HARDWARE MISC.': 0.09760956175298804,'BROAD HINGES': 0.0979020979020979,'VOS': 0.09741550695825049,'SCREEN REPAIR PARTS': 0.09870388833499502,'BUTYL': 0.09760956175298804,'CLAMPS NO HUB': 0.0979020979020979,'GLASS': 0.0979020979020979,'GRAVEL,ROCK, PAVERS': 0.09702970297029703,'2X8   STUD/PRECUT': 0.09057301293900184,'HWH DRILL  SCREWS': 0.09722222222222222,'ESCAPE': 0.09674234945705824,'SIDING - PNEUMATIC': 0.09770687936191426,'TILE TROWELS': 0.0979020979020979,'X2': 0.09770687936191426,'PREFINISHED - DR STOP': 0.09775171065493646,'ENTRY/DEADBOLT -KWIKSET': 0.10039370078740158,'LATEX /OIL BRUSH': 0.09780439121756487,'10" BLADES': 0.09741550695825049,'INDUSTRIAL ITEMS/PALLETS': 0.09523809523809523,'PRIVACY -HARDWARE HOUSE': 0.09831181727904667,'3"X18"  SANDING BELTS': 0.0979020979020979,'2X10   STUD/PRECUT': 0.09386973180076628,'PHL FH WOOD SCREW': 0.09780439121756487,'HANDLESET -HARDWARE HOUSE': 0.09780439121756487,'SHELF STANDARDS, PILASTER': 0.09731876861966236,'WHITE  SLAB': 0.0966796875,'SIDING GAUGE': 0.09780439121756487,'BOXES PLASTIC': 0.09780439121756487,'CONCRETE - CAULKING AND FILLER': 0.09760956175298804,'GRINDING / BUFFING WHEELS': 0.09880239520958084,'WIRING DEVICES WIRING CONNEC': 0.0979020979020979,'BACKER ROD': 0.09780439121756487,'ACID': 0.09780439121756487,'NAIL SETS & PUNCHES': 0.0979020979020979,'LATEX/OIL BEST LIEBCO': 0.0979020979020979,'MINERAL SPIRTS': 0.0979020979020979,'PREFINISHED': 0.10367577756833177,'COBALT BIT': 0.09770687936191426,'THINNER': 0.09760956175298804,'MISC TAPE': 0.09760956175298804,'GALLON ': 0.09760956175298804,'PACIFIC ROSEWOOD': 0.0979020979020979,'DISCONTINUED SCREWS': 0.09860557768924302,'STAPLER': 0.09770687936191426,'EXTERIOR': 0.09751243781094528,'SPECIALITY SPRAY PAINT': 0.0979020979020979,'BOX 4"': 0.09683794466403162,'CLAD FRAMES': 0.09760956175298804,'THREADED ROD': 0.09760956175298804,'STAINS-OLD MASTERS': 0.0979020979020979,'4-1/2" X 5-1/2" SHEETS': 0.0979020979020979,'GYPSUM WALLBOARD NAILS  ': 0.0979020979020979,'LACQUER': 0.09760956175298804,'6"   CEDAR SIDING': 0.09722222222222222,'DECK FASTENING': 0.0979020979020979,'FALCON': 0.09780439121756487,'IMPERIAL ': 0.09780439121756487,'POWER PRO': 0.0979020979020979,'WHITEWASH CEDAR': 0.10076775431861804,'WHEELS': 0.09860557768924302,'ALUM RAIL -CABLE': 0.09922928709055877,'BLUE TARPS': 0.09770687936191426,'MISC  - STOP': 0.09760956175298804,'TRIM TAPE': 0.09780439121756487,'SO Millwork': 0.06175514626218852,'T-SHANK': 0.0979020979020979,'18"   LVL/MICRO': 0.0979020979020979,'PAINT THINNER': 0.0979020979020979,'QT ': 0.0979020979020979,'HSS JOBBER BIT': 0.0979020979020979,'MAHOGANY FG SLAB': 0.0979020979020979,'JAMBS - SPLIT': 0.09722222222222222,'HASP': 0.09760956175298804,'MISC. SHARBITE': 0.0979020979020979,'SIDELITE': 0.0979020979020979,'PKG 3-1/2"': 0.09860557768924302,'STRAP HINGES': 0.0979020979020979,'ENTRY -HARDWARE HOUSE': 0.09821428571428571,'GUARD RAIL SYSTEM': 0.0979020979020979,'FH MACHINE ZINC SCREWS': 0.0979020979020979,'DEADBOLT DOUBLE CYLINDER -KWIKSET': 0.0979020979020979,'LACQUER MASKING': 0.09780439121756487,'CONSTRUCTION LUMBER': 0.10159362549800798,'CEDAR/RWD/TREAT/PRJ.': 0.10159362549800798,'FINISH/HARDWOOD/PINE': 0.10069790628115653,'CABINETS': 0.0989010989010989,'EXTERIOR DOORS': 0.10069790628115653,'WOOD WINDOWS': 0.0998003992015968,'NAILS/FASTNRS/HANGRS': 0.1012909632571996,'PANEL-OSB& SHEATING': 0.10069790628115653,'INTERIOR DOORS': 0.10159362549800798,'PAINT / GLASS': 0.0989010989010989,'ROOFING/INSUL/S.R.': 0.10069790628115653,'BULBS INCANDESCENT': 0.09780439121756487,'MOTION -EXT. LIGHTING': 0.0979020979020979,'BASEMENT COVER': 0.0979020979020979,'PAINT TRAY': 0.09870388833499502,'PANEL-SANDED & MISC': 0.10069790628115653,'CONCRETE & STEEL': 0.10069790628115653,'FINISH NAILS': 0.09712586719524281,'DOOR BOTTOMS/SWEEPS': 0.09770687936191426,'PLASTIC WALL ANCHORS': 0.0979020979020979,'SPECIAL ORDER PLYWOOD': 0.0979020979020979,'HANDLESET -KWIKSET': 0.09780439121756487,'HANDLESET INTERIOR ASSEMBLY -KWIKSET': 0.09780439121756487,'DUMMY - HARDWARE HOUSE': 0.09780439121756487,'PHILLIP PH SHEET METAL SCREWS': 0.09760956175298804,'DYNAFLEX 920': 0.0979020979020979,'INSERT': 0.0962671905697446,'TAPING KNIFE -DRYWALL': 0.09770687936191426,'PPH DRILL': 0.0979020979020979,'ENTRY DOOR WEATHERSTRIP': 0.09780439121756487,'TELL MFG': 0.09891196834817013,'PUSH/PULL PLATES, KICKPLATES, MAILSLOT': 0.09780439121756487,'PAINT PAILS & GLOVES': 0.09760956175298804,'CABINET SCREWS': 0.0979020979020979,'MENDING': 0.0979020979020979,'FLOOR JACKS': 0.09780439121756487,'GRAB BAR': 0.09831181727904667,'CONDUIT PVC & CONNECTORS': 0.09722222222222222,'PVC DWV FITTINGS 3"': 0.0979020979020979,'EXTERIOR CLEAR FINISHES': 0.0979020979020979,'TOGGLE BOLT': 0.09780439121756487,'STAPLER -PNEUMATIC': 0.09880239520958084,'HEAVY WIRE STAPLES 1" CROWN, 16 GAUGE, GALVANIZED (P SERIES)': 0.0979020979020979,'PAINT SETS': 0.0979020979020979,'SANDING  - OSCILLATING ACCESSORIES': 0.0979020979020979,'WAX RING-TOLIET REPAIR PARTS': 0.0979020979020979,'SURGE PROTECTORS': 0.0979020979020979,'DAP ': 0.09780439121756487,'OAK ASTRAGAL': 0.09860557768924302,'RED 1 COAT': 0.09780439121756487,'BASEMENT BUCK INSERTS': 0.0979020979020979,'LUBRICANTS ': 0.09751243781094528,'SCREWDRIVER BITS - PHILLIPS': 0.09780439121756487,'NUTSETTER': 0.0979020979020979,'FINISH 7-1/4': 0.09780439121756487,'ALDER - DR STOP': 0.09850746268656717,'BLOCK / SPONGE': 0.09780439121756487,'MARITIME GRAY': 0.09769585253456221,'DARK TEAK': 0.11070780399274047,'CEILING TILE': 0.09693372898120672,'SPEEDBORE MAX AUGER BITS': 0.09780439121756487,'CHAIN- CABLE ACCESSORIES': 0.0979020979020979,'CABLE - WIRE - CHAIN': 0.0979020979020979,'TR WH NEEDLE': 0.0979020979020979,'FORSTNER BITS': 0.0979020979020979,'RIGID  - STOP': 0.0979020979020979,'WOODLIFE': 0.09770687936191426,'PASSAGE -HARDWARE HOUSE': 0.09870388833499502,'CABINET PULLS': 0.09780439121756487,'MOULDING & MILLWORK': 0.10069790628115653,'PLUMBING/ELECTRICAL': 0.0989010989010989,'VINYL WINDOWS': 0.0989010989010989,'ROTARY CUTTING ACCESSORIES (ROTOZIP)': 0.0979020979020979,'FASCIA': 0.0979020979020979,'STORAGE HOOKS': 0.09880239520958084,'REPLACEMENT FAUCET HANDLES': 0.09870388833499502,'MORTISING BITS': 0.0979020979020979,'COCONUT HUSK': 0.09801980198019802,'TINTABLE ': 0.0979020979020979,'STILE & RAIL  BIFOLD': 0.09780439121756487,'BLACK PIPE': 0.0979020979020979,'5 GALLON': 0.0979020979020979,'BARREL': 0.09870388833499502,'Misc': 0.0979020979020979,'BRAD POINT BITS': 0.0979020979020979,'HVY DUTY TARP': 0.09780439121756487,'SGL. WALL PIPE & FITTINGS 6IN': 0.0979020979020979,'BATTERIES & CHARGERS': 0.0979020979020979,'SCREWDRIVER BITS - TORX ': 0.09770687936191426,'NEWEL  ': 0.0979020979020979,'16 GAUGE ANGLED FINISH NAIL (PASLODE)': 0.0979020979020979,'PACIFIC WALNUT': 0.0979020979020979,'SMOOTH FG SLAB': 0.09780439121756487,'ALUM RAIL -POST CAP CBT': 0.1002979145978153,'MISC BITS': 0.0979020979020979,'WORK BENCH': 0.09780439121756487,'OUTDOOR MISC.': 0.09751243781094528,'SPRINKLERS': 0.0979020979020979,'INSECTICIDE': 0.0979020979020979,'PULLS & HANDLES': 0.0979020979020979,'CABINET JIGS KREG': 0.0979020979020979,'STEP LADDERS': 0.09780439121756487,'MISC -POCKET HOLE': 0.0979020979020979,'COLORED PUTTY': 0.09780439121756487,'WHEEL BARROWS': 0.0979020979020979,'BROOM HANDLES': 0.09780439121756487,'SAFETY & SNOW FENCING': 0.09780439121756487,'T & U POSTS': 0.09722222222222222,'CONTACT GLUE': 0.0979020979020979,'SPECIAL PURPOSE HINGES': 0.0979020979020979,'DEADBOLT- HARDWARE HOUSE': 0.0979020979020979,'GROUT SPONGES': 0.0979020979020979,'DISCONTINUED METAL': 0.0979020979020979,'LIVINGSTON SLAB': 0.09751243781094528,'LIVINGSTON BIFOLD': 0.09780439121756487,'POPLAR    - ROSETTE/CORNER': 0.0979020979020979,'VENT PIPE FLASHING': 0.0979020979020979,'4" -PAINT ROLLER FRAME': 0.09870388833499502,'4" -PAINT ROLLER': 0.09780439121756487,'S2S': 0.0979020979020979,'AIR HOSE FITTINGS': 0.0979020979020979,'AIR HOSE': 0.09860557768924302,'JOIST HANGER NAILER': 0.0979020979020979,'RESPIRATORS': 0.0979020979020979,'CLEANER': 0.09780439121756487,'BRICKMOULD ': 0.0979020979020979,'HSS AIRCRAFT': 0.0979020979020979,'BROOM PUSH': 0.0979020979020979,'EXTENSION CORDS': 0.09780439121756487,'HARD HATS': 0.0979020979020979,'POLYURETHANE ': 0.09780439121756487,'RETAIL BLISTER PACKS': 0.0979020979020979,'20 GAUGE FLOOR STAPLE': 0.09780439121756487,'HICKORY': 0.0979431929480901,'ORNAMENTAL HINGES': 0.09880239520958084,'WIPING STAIN 1/2 PT': 0.0979020979020979,"50' ROPE & CORD": 0.0979020979020979,'23 GAUGE GALVANIZED MICRO PINS (MP23 SERIES)': 0.0979020979020979,'FROG TAPE': 0.0979020979020979,'HICKORY S4S': 0.0984251968503937,'PARMTITE HOT GLUE': 0.0979020979020979,'OLDMASTER QT AND GALLONS': 0.0979020979020979,'INTERIOR FINISHES': 0.0979020979020979,'LOPEZ / SANTA FE SLAB': 0.09741550695825049,'LOPEZ / SANTA FE BIFOLD': 0.09760956175298804,'HICKORY - SMALL': 0.09780439121756487,'WHIZ LOCK': 0.0979020979020979,'CUSTOM SLABS': 0.0979020979020979,'MADISON SLAB': 0.09751243781094528,'MADISON BIFOLD': 0.09770687936191426,'DRILL ACCESSORIES': 0.09770687936191426,'DRILL BIT - MISC.': 0.0979020979020979,'HICKORY - LIBRARY MLD': 0.0979020979020979,'GLUE MISC': 0.0979020979020979,'C CLAMPS': 0.0979020979020979,'BULBS - LED': 0.0979020979020979,'EYE BOLT': 0.0979020979020979,'CABLE TIES': 0.0979020979020979,'PECAN': 0.09780439121756487,'CAMODRIVE DECK FASTENING': 0.09780439121756487}
    subgroup_return_config_final = {}
    
    for subgroup, probability in subgroup_return_config.items():
        subgroup_return_config_final[subgroup] = probability
        subgroup_return_config_final[subgroup.strip()] = probability
    
    # Replace subgroup column with return rates
    df['Subgroup'] = df['Subgroup'].map(lambda x: subgroup_return_config.get(x, overall_return_rate))
    
    
    major_prodlines_list = ['CONSTRUCTION LUMBER', 'CEDAR/RWD/TREAT/PRJ.', 'SIDING/EXT TRIM', 'CABINETS', 'MOULDING & MILLWORK', 'NAILS/FASTNRS/HANGRS', 'PANEL-OSB& SHEATING', 'INTERIOR DOORS', 'CONCRETE & STEEL', 'FINISH/HARDWOOD/PINE', 'HARDWARE', 'VINYL WINDOWS', 'WOOD WINDOWS', 'PANEL-SANDED & MISC', 'EXTERIOR DOORS', 'PAINT / GLASS', 'ROOFING/INSUL/S.R.', 'TOOLS', 'LABOR PDL 46', 'PLUMBING/ELECTRICAL']
    
    # Function to check if subgroup is in major_subgroups_list
    def is_small_prodline(prodline):
        return 1 if prodline not in major_prodlines_list else 0

    # Create prdline_small column
    df['small_prodline'] = df['ProdLine'].apply(is_small_subgroup)
    
    
    
    productLine_return_config = {'MOULDING & MILLWORK': 0.1870216023133186, 'CONSTRUCTION LUMBER': 0.09723851801676485, 'PAINT / GLASS': 0.03454510848877046, 'PANEL-OSB& SHEATING': 0.10732051377236618, 'CEDAR/RWD/TREAT/PRJ.': 0.13042595662617992, 'SIDING/EXT TRIM': 0.18398664410190732, 'NAILS/FASTNRS/HANGRS': 0.0500586476976049, 'HARDWARE': 0.037138492335247325, 'CONCRETE & STEEL': 0.0869449378330373, 'INTERIOR DOORS': 0.022481841589485414, 'ROOFING/INSUL/S.R.': 0.04994023110638863, 'FINISH/HARDWOOD/PINE': 0.184305408271474, 'WOOD WINDOWS': 0.01820147774373761, 'VINYL WINDOWS': 0.027847049044056525, 'CABINETS': 0.015251417303426176, 'PANEL-SANDED & MISC': 0.15797694310152474, 'PLUMBING/ELECTRICAL': 0.06134603930911257, 'TOOLS': 0.04786597526924611, 'EXTERIOR DOORS': 0.06141424027403964, 'FLOORING PDL 35': 0.1072961373390558, 'LABOR PDL 46': 0.05239982386613826, 'TRUSSES- ROOF& FLOOR': 0.09692898272552783}
    productLine_return_config_final = {}
    
    for prodline, probability in productLine_return_config.items():
        productLine_return_config_final[prodline] = probability
        productLine_return_config_final[prodline.strip()] = probability
    
    df['ProdLine'] = df['ProdLine'].map(lambda x: productLine_return_config.get(x, overall_return_rate))
    
    
    customer_types = ['Home Builders', 'Remodelers', 'Retail', 'Commercial Accounts']
    
    
    for customertype in customer_types:
        def is_customer_type(CustomerType):
            return 1 if CustomerType == customertype else 0
        
        
        column_name = f"CustomerType_{customertype}"
        df[column_name] = df["CustomerType"].apply(is_customer_type)
        
    
    # stores = ['McCormick', 'West St.', 'Greenwich']
    
    
    # for store in stores:
    #     def is_store(Store):
    #         return 1 if Store == store else 0
        
        
    #     column_name = f"Store_{store}"
    #     df[column_name] = df["Store"].apply(is_store)
        
    
    def is_charge(CashOrCharge):
        return 1 if CashOrCharge == "Chg" else 0
    
    df["ChargedToAccount"] = df["CashOrCharge"].apply(is_charge)
    
    
    return df


def get_model_results(df):
    columns_for_model = ["Quantity", "TotalSales", "Subgroup", "ProdLine", "small_prodline", "CustomerType_Commercial Accounts", "CustomerType_Remodelers", "CustomerType_Retail", "Category_General Inventory", "Category_SpecialOrder", "ChargedToAccount"]
    def get_catboost_tier(probability):
        if probability <= 0.000383:
            tier = 1
        elif probability <= 0.000782:
            tier = 2
        elif probability <= 0.001704:
            tier = 3
        elif probability <= 0.011883:
            tier = 4
        elif probability <= 0.029421:
            tier = 5
        elif probability <= 0.044979:
            tier = 6
        elif probability <= 0.061489:
            tier = 7
        elif probability <= 0.08035:
            tier = 8
        elif probability <= 0.101607:
            tier = 9
        elif probability <= 0.125245:
            tier = 10
        elif probability <= 0.151953:
            tier = 11
        elif probability <= 0.18313:
            tier = 12
        elif probability <= 0.22065:
            tier = 13
        elif probability <= 0.265715:
            tier = 14
        elif probability <= 0.321777:
            tier = 15
        elif probability <= 0.394846:
            tier = 16
        elif probability <= 0.493129:
            tier = 17
        elif probability <= 0.629603:
            tier = 18
        elif probability <= 0.830247:
            tier = 19
        else:
            tier = 20

        return tier
    X = df[columns_for_model]
    X.columns = ["Qty_Capped", "TotalSales_Capped", "Subg_ret", "ProdLineName_ret", "ProdLineName_small", "CustType_top4_Commercial Accounts", "CustType_top4_Remodelers", "CustType_top4_Retail", "Category_General Inventory", "Category_SpecialOrders", "CashorCharge_Chg"]
    model = joblib.load("catboost_model_smote.pkl")
    X_predict_proba = model.predict_proba(X)[:,1]
    # print(X_predict_proba)
    df["CatBoost_Probability"] = X_predict_proba
    df["Model Tier"] = df["CatBoost_Probability"].apply(get_catboost_tier)
    
    def risk_level(tier):
        if tier<=10:
            risk = "Low"
        elif tier<=16:
            risk = "Medium"
        else:
            risk = "High"
        return risk
    df["Risk Level"] = df["Model Tier"].apply(risk_level)
    return df





@st.cache_resource
def load_model():
    return joblib.load("catboost_model_smote.pkl")

model = load_model()


def display_risk_message(risk, probability):
    if risk == "Low":
        color = "green"
    elif risk == "Medium":
        color = "yellow"
    else:  # "High" risk
        color = "red"


    # Define colors for both background and text
    bg_colors = {"Low": "green", "Medium": "yellow", "High": "red"}
    text_colors = {"Low": "white", "Medium": "black", "High": "white"}

    # Pick colors based on risk level
    bg_color = bg_colors[risk]
    text_color = text_colors[risk]

    # Using markdown and inline CSS to style the output
    st.markdown(f"""
    <style>
    .risk-message {{
        padding: 5px;
        border-radius: 5px;
        text-align: center;
    }}
    </style>
    <div class="risk-message" style="background-color: {bg_color}; color: {text_color};">
        This transaction has a <strong>{risk}</strong> risk of getting returned. 
        Model Predicted Probability: {probability:.2f}
    </div>
    """, unsafe_allow_html=True)
    





# Streamlit form for user input
with st.form(key='user_input_form'):
    st.header("Transaction Risk Assessment Form")
    product_line_name = st.text_input("Product Line Name")
    subgroup = st.text_input("Subgroup")
    product_code = st.text_input("Product Code")
    cash_or_charge = st.selectbox("CashOrCharge", ["Csh", "Chg"])
    quantity = st.number_input("Quantity", min_value=1)
    total_sales_value = st.number_input("TotalSales Value", min_value=0.01)
    customer_type = st.text_input("Customer Type")
    submit_button = st.form_submit_button(label="Submit")

if submit_button:
    # Create a DataFrame with the entered data
    df = pd.DataFrame({
        'ProdLine': [product_line_name],
        'Subgroup': [subgroup],
        'Quantity': [quantity],
        'TotalSales': [total_sales_value],
        'ProductCode': [product_code],
        'CashOrCharge': [cash_or_charge],
        'CustomerType': [customer_type],
    })

    # Data processing and prediction
    try:
        cleaned_df = data_clean(df)
        features_df = get_features(cleaned_df)
        final_df = get_model_results(features_df)
        probability = final_df["CatBoost_Probability"].iloc[0]
        risk = final_df["Risk Level"].iloc[0]

        # Display the results
        display_risk_message(risk, probability)
    except Exception as e:
        st.error(f"Error processing the form: {str(e)}")